# Анишкин треугольник

## Что он делает?

Вы можете использовать эту программу для определения пересечения треугольников в трёхмерном пространстве, а так же для визуализации их в пространстве.

## Какой принцип работы?

Наш треугольник задается тремя координатами вершин. В зависимости от их значений у нас может возникнуть как вырожденный, так и не вырожденный случаи:

1. Если все точки не лежат на одной прямой - треугольник

    (0, 5, 0), (5, 0, 0), (0, 0, 0):
<image src="for_readme/p1.png" width=250px>

2. Если все точки не совпадают и лежат на одной прямой - отрезок

    (0, 5, 0), (2.5, 2.5, 0), (5, 0, 0):
<image src="for_readme/p2.png" width=250px>

3. Если все точки совпадают - точка

    (2.5, 2.5, 0), (2.5, 2.5, 0), (2.5, 2.5, 0):
<image src="for_readme/p3.png" width=250px>

Рассмотрим каждый из случаев отдельно:

#### Две точки

Проверяем совпадают ли эти две точки.

#### Отрезок и точка

Проверяем находится ли точка между концами отрезка на прямой, на которой лежит отрезок.

#### Треугольник и точка

С помощью метода площадей проверяем находится ли точка внутри треугольника.

<image src="for_readme/p4.png" width=200px>

Если S1 + S2 + S3 = S всей фигуры, значит вырожденный треугольник-точка пересекается со вторым треугольником

#### Два отрезка

Для определения пересечения проверяем имеет ли решение система уравнений прямых(заданных параметрически), на которых лежат отрезки.

Допустим у нас есть две прямые:

<image src="for_readme/p5.png" width=300px>

Приравнивая первые две строчки друг с другом мы получим t и s. Если после подстановки в третью строку мы получим одинаковые z, значит прямые пересекаются. Далее просто проверяем лежит ли эта точка между концами отрезков.

#### Треугольник и отрезок

Если треугольник и отрезок лежат на одной плоскости, то с помощью предыдущего пункта проверяем пересекает ли отрезок хотя бы одно ребро треугольника.

Если они не лежат на одной плоскости, то определяем пересечение с помощью [алгоритма Мёллера-Тромбора](https://ru.wikipedia.org/wiki/Алгоритм_Моллера_—_Трумбора#:~:text=Алгоритм%20Моллера%20—%20Трумбора%20—%20алгоритм%20для,вычисление%20уравнения%20плоскости%2C%20содержащей%20треугольник.)

#### Два треугольника

Для определения пересечения я воспользовалась книгой ["Geometric Tools for Computer Graphics" авторов Philip J. Schneider David H. Eberly](for_readme/Geometric_Tools_for_Computer_Graphics.pdf) (страница 539), где подробно описаны шаги. Но в этом параграфе не учитываются случаи, когда вектора нормали плоскостей, в которых лежат треугольники, коллинеарны:

Если направляющие вектора коллинеарны, но плоскости не совпадают - треугольники не пересекаются.

Если плоскости совпадают, то наша задача сводится к двухмерному случаю. Для определения пересения воспользовалась [той же самой книгой](for_readme/Geometric_Tools_for_Computer_Graphics.pdf) (страница 265).

### Октодеревья

Для более оптимизированной работы программы я добавила разбиение пространства через октодеревья. Идею реализацию, которую взяла я, можно посмотреть в [этой статье](https://habr.com/ru/articles/334990/).

### Графики треугольников

Если вы вдруг сомневаетесь пересекаются ли треугольники, то можно графически изобразить их с помощью моего python-скрипта. Он работает как для вырожденных, так и для невырожденных случаев:

<image src="graph/figure_2.png" width=400px>

Графики можно покрутить-повертеть, что бы лучше разглядеть треугольники:)

## Как запустить программу?

```
mkdir build && cd build
```

Для ручного ввода данных достаточно ввести команду

```
cmake ../
```

Для запуска юнит-тестов нужно добавить флаг

```
cmake ../ -DTEST=ON
```

Для запуска ручного ввода и тестов соответсвенно:

```
./3dtr
./test
```

Для вывода графиков треугольников надо ввести команду:

```
python3 ../graph/graph_maker.py
```

## Как выглядит результат работы программы?

Для этого теста:

```
6
1 0 0 0 1 0 0 0 1
0 0 0 1 1 1 0 0 2
3 4 5 5 6 7 3 8 9
5 3 2 2 -2 1 2 2 0
5 5 5 2 2 -3 2 2 2
3 3 3 2 2 1 4 2 1
```

результат работы программы будет таким:

```
0
1
3
4
5
```

где нумерация треугольников начинается с 0.

И как мы видим из графика:

<image src="graph/figure_1.png" width=400px>

действительно, все треугольники имеют пересечения с каким-либо другим треугольником кроме второго (на рисунке выделен красным).